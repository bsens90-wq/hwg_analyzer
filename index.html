<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>보장분석 앱</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,">
  <style>
    :root{
      --hanwha:#ff7f00;
      --hanwha-dark:#e67100;
      --bg:#f8f9fa;
      --card:#ffffff;
      --text:#333;
      --muted:#777;
      --border:#e6e6e6;
      --success:#28a745;
      --warning:#ffc107;
      --danger:#dc3545;
    }
    
    *{box-sizing:border-box}
    body{
      margin:0;
      padding-top: 70px;
      font-family: "Noto Sans KR", Arial, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height: 1.4;
    }
    
    .header-fixed {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      background: var(--bg);
      border-bottom: 2px solid #ccc;
      padding: 8px 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,.08);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .logo-container {
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-block;
    }
    
    .logo-container:hover {
      transform: scale(1.05);
    }
    
    .logo-main {
      font-size: 32px;
      font-weight: 900;
      color: var(--hanwha);
      letter-spacing: 3px;
      text-shadow: 0 2px 4px rgba(255,127,0,0.2);
      margin: 0;
      line-height: 1;
    }
    
    .screen{
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      padding:1rem;
    }
    
    .app-title{
      font-size:24px;
      font-weight:700;
      color:var(--hanwha);
      margin-bottom:2rem;
      text-align:center;
    }
    
    .card{
      width:100%;
      max-width:520px;
      background:var(--card);
      border-radius:16px;
      box-shadow:0 6px 18px rgba(0,0,0,.08);
      padding:20px;
      margin-bottom:20px;
    }

    /* 입력 화면 전용 스타일 */
    .input-screen {
      max-width: 100%;
      padding: 0.5rem;
    }

    .input-card {
      width: 100%;
      background: var(--card);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .customer-name-section {
      text-align: center;
      margin-bottom: 24px;
      padding: 20px;
      background: linear-gradient(135deg, #ff7f00, #ff9933);
      border-radius: 12px;
      color: white;
    }

    .customer-name-input {
      width: 100%;
      max-width: 200px;
      padding: 12px;
      border: none;
      border-radius: 8px;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      margin: 8px 0;
    }

    .section-title {
      font-size: 18px;
      font-weight: bold;
      color: var(--text);
      margin-bottom: 16px;
      padding-bottom: 8px;
      border-bottom: 2px solid var(--hanwha);
    }

    .input-group {
      margin-bottom: 16px;
    }

    .input-label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 6px;
    }

    .input-field {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 16px;
      background: white;
      transition: border-color 0.3s ease;
    }

    .input-field:focus {
      outline: none;
      border-color: var(--hanwha);
      box-shadow: 0 0 0 2px rgba(255, 127, 0, 0.2);
    }

    .input-unit {
      font-size: 14px;
      color: var(--muted);
      margin-left: 8px;
    }
    
    button{
      width:100%;
      padding:14px 16px;
      background:var(--hanwha);
      color:#fff;
      border:none;
      border-radius:10px;
      font-weight:700;
      cursor:pointer;
      font-size:16px;
      margin-bottom:8px;
      transition: all 0.3s ease;
    }
    
    button:hover{
      background:var(--hanwha-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 127, 0, 0.3);
    }
    
    button.secondary{
      background:#6c757d;
      margin-bottom:0;
    }
    
    button.secondary:hover{
      background:#545b62;
      box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
    }
    
    .saved-item{
      background:#fff;
      border:1px solid var(--border);
      border-radius:12px;
      padding:16px;
      margin-bottom:12px;
      cursor:pointer;
      transition:all 0.2s ease;
    }
    
    .saved-item:hover{
      background:#f8f9fa;
      transform:translateY(-2px);
      box-shadow:0 4px 12px rgba(0,0,0,.1);
    }
    
    .saved-item-title{
      font-size:16px;
      font-weight:600;
      color:var(--text);
      margin-bottom:5px;
    }
    
    .saved-item-date{
      font-size:12px;
      color:var(--muted);
    }
    
    .meta{
      color:var(--muted); 
      font-size:13px; 
      margin-top:.25rem;
      text-align:center;
    }
    
    .error{
      color:#d93025; 
      font-size:14px; 
      margin-top:.5rem;
      text-align:center;
    }
    
    .success{
      color:#28a745; 
      font-size:14px; 
      margin-top:.5rem;
      text-align:center;
    }

    /* 계산된 필드 표시 */
    .calculated-field {
      background: #f0f8ff !important;
      border-color: #007bff !important;
    }

    .calculated-field::after {
      content: ' (자동계산)';
      font-size: 12px;
      color: #007bff;
    }

    /* 조건부 서식을 위한 클래스 */
    .status-good { background-color: #d4edda !important; border-color: #28a745 !important; }
    .status-warning { background-color: #fff3cd !important; border-color: #ffc107 !important; }
    .status-poor { background-color: #f8d7da !important; border-color: #dc3545 !important; }

    @media (max-width: 768px) {
      .screen { padding: 0.25rem; }
      .input-card { padding: 12px; margin-bottom: 12px; }
      .customer-name-section { padding: 16px; }
    }

    /* 이미지 생성용 숨김 스타일 */
    .hidden-canvas {
      position: absolute;
      top: -9999px;
      left: -9999px;
      width: 800px;
      background: white;
      padding: 30px;
      font-family: "Noto Sans KR", Arial, sans-serif;
    }

    .report-header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: linear-gradient(135deg, #ff7f00, #ff9933);
      color: white;
      border-radius: 12px;
    }

    .report-title {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .report-subtitle {
      font-size: 16px;
      opacity: 0.9;
    }

    .report-section {
      margin-bottom: 25px;
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .report-section-title {
      font-size: 18px;
      font-weight: bold;
      color: #333;
      margin-bottom: 15px;
      padding-bottom: 8px;
      border-bottom: 2px solid #ff7f00;
    }

    .report-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    .report-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 6px;
      border-left: 4px solid #ff7f00;
    }

    .report-item-label {
      font-weight: 600;
      color: #333;
    }

    .report-item-value {
      font-weight: bold;
      color: #007bff;
    }

    .progress-bar {
      width: 100%;
      height: 20px;
      background: #e9ecef;
      border-radius: 10px;
      overflow: hidden;
      margin-top: 5px;
    }

    .progress-fill {
      height: 100%;
      transition: width 0.3s ease;
    }

    .progress-good { background: #28a745; }
    .progress-warning { background: #ffc107; }
    .progress-poor { background: #dc3545; }
  </style>
</head>
<body>
  <div class="header-fixed">
    <div class="logo-container" onclick="goHome()">
      <div class="logo-main">보장분석</div>
    </div>
  </div>

  <!-- 메뉴 화면 -->
  <section id="menuScreen" class="screen">
    <div class="app-title">보장분석 앱</div>
    <div class="card">
      <h2 style="margin:0 0 1.5rem 0;">메뉴 선택</h2>
      
      <button id="inputMenuBtn" style="margin-bottom:1rem;">
        <span style="font-size:18px; display:block; margin-bottom:4px;">입력하기</span>
        <span style="font-size:14px; opacity:0.8;">새로운 보장분석 작성</span>
      </button>
      
      <button id="loadMenuBtn" style="margin-bottom:1rem;">
        <span style="font-size:18px; display:block; margin-bottom:4px;">불러오기</span>
        <span style="font-size:14px; opacity:0.8;">저장된 보장분석 불러오기</span>
      </button>

      <div class="meta" style="margin-top:2rem;">Copyright 2025 보장분석 앱</div>
    </div>
  </section>

  <!-- 입력 화면 -->
  <section id="inputScreen" class="screen input-screen" style="display:none;">
    <div class="app-title">보장분석 입력</div>
    
    <!-- 고객명 섹션 -->
    <div class="customer-name-section">
      <div style="font-size: 20px; margin-bottom: 8px;">고객정보</div>
      <input type="text" id="customerName" placeholder="고객명 입력" class="customer-name-input">
      <div style="font-size: 16px; margin-top: 8px;">님의 한 장 요약 보장분석</div>
    </div>

    <!-- 암관련보장 섹션 -->
    <div class="input-card">
      <div class="section-title">암관련보장</div>
      <div class="input-group">
        <label class="input-label">일반암진단비</label>
        <input type="number" id="C5" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">통합암진단비</label>
        <input type="number" id="C6" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">전이암진단비</label>
        <input type="number" id="C7" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">암특정치료비</label>
        <input type="number" id="C8" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">암특정치료비(비급여)</label>
        <input type="number" id="C9" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">표적항암치료비</label>
        <input type="number" id="C10" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">중입자치료비</label>
        <input type="number" id="C11" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">암수술비</label>
        <input type="number" id="C12" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">다빈치로봇수술비</label>
        <input type="number" id="C13" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">1-5종수술비(5종)</label>
        <input type="number" id="C14" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
    </div>

    <!-- 뇌혈관/심장관련보장 섹션 -->
    <div class="input-card">
      <div class="section-title">뇌혈관/심장관련보장</div>
      <div class="input-group">
        <label class="input-label">뇌혈관질환진단비</label>
        <input type="number" id="G5" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">뇌졸중진단비</label>
        <input type="number" id="G6" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">허혈성심장질환진단비</label>
        <input type="number" id="G7" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">심근경색진단비</label>
        <input type="number" id="G8" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">뇌혈관질환수술비</label>
        <input type="number" id="G9" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">뇌졸중수술비</label>
        <input type="number" id="G10" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">허혈성심장질환수술비</label>
        <input type="number" id="G11" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">심근경색수술비</label>
        <input type="number" id="G12" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">뇌졸중혈전용해</label>
        <input type="number" id="G13" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">심근경색혈전용해</label>
        <input type="number" id="G14" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">2대특정치료비</label>
        <input type="number" id="G15" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">주요순환계(수술)</label>
        <input type="number" id="G16" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">주요순환계(혈전제거)</label>
        <input type="number" id="G17" class="input-field calculated-field" readonly><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">주요순환계(혈전용해)</label>
        <input type="number" id="G18" class="input-field calculated-field" readonly><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">주요순환계(중환자실)</label>
        <input type="number" id="G19" class="input-field calculated-field" readonly><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">혈전제거치료비</label>
        <input type="number" id="G20" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">1-5종수술비(3종)</label>
        <input type="number" id="G21" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">1-5종수술비(5종)</label>
        <input type="number" id="G22" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">124대질병수술비(특정10대)</label>
        <input type="number" id="G23" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">7대기관수술비(뇌/심) 관혈</label>
        <input type="number" id="G24" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
    </div>

    <!-- 의료실비/운전자/간병비 섹션 -->
    <div class="input-card">
      <div class="section-title">의료실비</div>
      <div class="input-group">
        <label class="input-label">(질병)입원한도</label>
        <input type="number" id="J5" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">(질병)통원한도</label>
        <input type="number" id="J6" class="input-field" placeholder="0"><span class="input-unit">일</span>
      </div>
      <div class="input-group">
        <label class="input-label">(상해)입원한도</label>
        <input type="number" id="J7" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">(상해)통원한도</label>
        <input type="number" id="J8" class="input-field" placeholder="0"><span class="input-unit">일</span>
      </div>
    </div>

    <div class="input-card">
      <div class="section-title">운전자보장</div>
      <div class="input-group">
        <label class="input-label">형사합의금</label>
        <input type="number" id="J11" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">변호사선임비</label>
        <input type="number" id="J12" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">간병인일당</label>
        <input type="number" id="J13" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
    </div>

    <div class="input-card">
      <div class="section-title">간병비</div>
      <div class="input-group">
        <label class="input-label">요양병원 외</label>
        <input type="number" id="J16" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">요양병원</label>
        <input type="number" id="J17" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
      <div class="input-group">
        <label class="input-label">간호간병통합</label>
        <input type="number" id="J18" class="input-field" placeholder="0"><span class="input-unit">만원</span>
      </div>
    </div>

    <div class="input-card">
      <div class="section-title">기타보장</div>
      <div class="input-group">
        <label class="input-label">일상생활배상책임 (보장액/자기부담금)</label>
        <div style="display: flex; gap: 10px;">
          <input type="number" id="I21" class="input-field" placeholder="0" style="flex: 1;"><span class="input-unit">만원</span>
          <input type="number" id="J21" class="input-field" placeholder="0" style="flex: 1;"><span class="input-unit">만원</span>
        </div>
      </div>
      <div class="input-group">
        <label class="input-label">화재벌금 (보장액/자기부담금)</label>
        <div style="display: flex; gap: 10px;">
          <input type="number" id="I24" class="input-field" placeholder="0" style="flex: 1;"><span class="input-unit">만원</span>
          <input type="number" id="J24" class="input-field" placeholder="0" style="flex: 1;"><span class="input-unit">만원</span>
        </div>
      </div>
    </div>

    <!-- 버튼 영역 -->
    <div style="margin-top: 20px; display: flex; flex-direction: column; gap: 10px;">
      <button id="saveImageBtn">이미지로 저장하기</button>
      <button id="loadFromMenuBtn" class="secondary">불러오기</button>
      <button id="backToMenuBtn" class="secondary">뒤로가기</button>
      
      <div id="statusMessage" class="meta"></div>
    </div>
  </section>

  <!-- 불러오기 화면 -->
  <section id="loadScreen" class="screen" style="display:none;">
    <div class="app-title">저장된 보장분석</div>
    <div class="card">
      <h2 style="margin:0 0 1rem 0;">저장된 목록</h2>
      <div id="savedList">
        <!-- 저장된 항목들이 여기에 표시됩니다 -->
      </div>
      <button id="backToMenuFromLoadBtn" class="secondary" style="margin-top:20px;">뒤로가기</button>
    </div>
  </section>

<script>
let currentScreen = 'menu';
let savedData = JSON.parse(localStorage.getItem('insuranceAnalysisData')) || [];

// 화면 전환 함수
function hideAllScreens() {
  document.getElementById("menuScreen").style.display = "none";
  document.getElementById("inputScreen").style.display = "none";
  document.getElementById("loadScreen").style.display = "none";
}

function navigateToScreen(screen) {
  currentScreen = screen;
  hideAllScreens();
  
  switch(screen) {
    case 'menu':
      document.getElementById("menuScreen").style.display = "flex";
      break;
    case 'input':
      document.getElementById("inputScreen").style.display = "flex";
      setupFormCalculations();
      break;
    case 'load':
      document.getElementById("loadScreen").style.display = "flex";
      displaySavedList();
      break;
  }
}

// 홈으로 이동
function goHome() {
  navigateToScreen('menu');
}

// 계산 필드 설정
function setupFormCalculations() {
  const allInputs = document.querySelectorAll('.input-field[type="number"]');
  allInputs.forEach(input => {
    input.addEventListener('input', function() {
      updateCalculatedFields();
      applyConditionalFormatting();
    });
    input.addEventListener('change', function() {
      updateCalculatedFields();
      applyConditionalFormatting();
    });
  });
  
  applyConditionalFormatting();
}

// 계산 필드 업데이트 (G16 기반 계산)
function updateCalculatedFields() {
  const g16Value = parseFloat(document.getElementById('G16')?.value) || 0;
  
  // G17 = G16 (주요순환계 혈전제거)
  const g17Input = document.getElementById('G17');
  if (g17Input) g17Input.value = g16Value;
  
  // G18 = G16 (주요순환계 혈전용해)
  const g18Input = document.getElementById('G18');
  if (g18Input) g18Input.value = g16Value;
  
  // G19 = G16/2 (주요순환계 중환자실)
  const g19Input = document.getElementById('G19');
  if (g19Input) g19Input.value = Math.floor(g16Value / 2);
}

// 조건부 서식 적용
function applyConditionalFormatting() {
  // 1보다 큰 값은 좋음, 작으면 나쁨으로 표시
  const greaterThanOneIds = ['J5', 'J6', 'J7', 'J8', 'J16', 'J17', 'J18', 'I21', 'J21', 'I24', 'J24'];
  greaterThanOneIds.forEach(id => {
    const input = document.getElementById(id);
    if (!input) return;
    
    const value = parseFloat(input.value) || 0;
    input.classList.remove('status-good', 'status-poor');
    
    if (value > 1) {
      input.classList.add('status-good');
    } else if (value > 0) {
      input.classList.add('status-poor');
    }
  });
  
  // J11 특별 조건 (형사합의금)
  const j11Input = document.getElementById('J11');
  if (j11Input) {
    const value = parseFloat(j11Input.value) || 0;
    j11Input.classList.remove('status-good', 'status-warning', 'status-poor');
    
    if (value >= 20000) {
      j11Input.classList.add('status-good');
    } else if (value >= 10000) {
      j11Input.classList.add('status-warning');
    } else if (value > 0) {
      j11Input.classList.add('status-poor');
    }
  }
  
  // J12 특별 조건 (변호사선임비)
  const j12Input = document.getElementById('J12');
  if (j12Input) {
    const value = parseFloat(j12Input.value) || 0;
    j12Input.classList.remove('status-good', 'status-warning', 'status-poor');
    
    if (value >= 5000) {
      j12Input.classList.add('status-good');
    } else if (value >= 3000) {
      j12Input.classList.add('status-warning');
    } else if (value > 0) {
      j12Input.classList.add('status-poor');
    }
  }
}

// 데이터 저장 및 이미지 생성
function saveData() {
  const customerName = document.getElementById('customerName').value.trim();
  
  if (!customerName) {
    showMessage('고객명을 입력해주세요.', 'error');
    return;
  }
  
  // 데이터 수집
  const data = {
    id: Date.now(),
    customerName: customerName,
    timestamp: new Date().toLocaleString('ko-KR'),
    values: {}
  };
  
  // 모든 입력 필드 값 저장
  const inputFields = [
    'C5', 'C6', 'C7', 'C8', 'C9', 'C10', 'C11', 'C12', 'C13', 'C14',
    'G5', 'G6', 'G7', 'G8', 'G9', 'G10', 'G11', 'G12', 'G13', 'G14', 
    'G15', 'G16', 'G17', 'G18', 'G19', 'G20', 'G21', 'G22', 'G23', 'G24',
    'J5', 'J6', 'J7', 'J8', 'J11', 'J12', 'J13', 'J16', 'J17', 'J18', 'I21', 'J21', 'I24', 'J24'
  ];
  
  inputFields.forEach(fieldId => {
    const field = document.getElementById(fieldId);
    if (field) {
      data.values[fieldId] = parseFloat(field.value) || 0;
    }
  });
  
  // 로컬스토리지에 저장
  const existingIndex = savedData.findIndex(item => item.customerName === customerName);
  if (existingIndex >= 0) {
    savedData[existingIndex] = data;
  } else {
    savedData.push(data);
  }
  
  localStorage.setItem('insuranceAnalysisData', JSON.stringify(savedData));
  showMessage('저장되었습니다!', 'success');
  
  // 개선된 이미지 생성
  generateProfessionalImage(data);
}

// 전문적인 이미지 생성
function generateProfessionalImage(data) {
  // 숨김 캔버스 생성
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  
  canvas.width = 800;
  canvas.height = 1200;
  
  // 배경 그라디언트
  const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
  gradient.addColorStop(0, '#ffffff');
  gradient.addColorStop(1, '#f8f9fa');
  ctx.fillStyle = gradient;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  // 헤더 섹션
  const headerGradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
  headerGradient.addColorStop(0, '#ff7f00');
  headerGradient.addColorStop(1, '#ff9933');
  ctx.fillStyle = headerGradient;
  ctx.fillRect(30, 30, canvas.width - 60, 120);
  
  // 헤더 텍스트
  ctx.fillStyle = '#ffffff';
  ctx.font = 'bold 32px Arial';
  ctx.textAlign = 'center';
  ctx.fillText(`${data.customerName}님의 보장분석`, canvas.width / 2, 80);
  
  ctx.font = '16px Arial';
  ctx.fillText(`생성일: ${data.timestamp}`, canvas.width / 2, 110);
  ctx.fillText('한 장 요약 보장분석 리포트', canvas.width / 2, 130);
  
  let yPos = 200;
  
  // 섹션별 데이터 표시
  const sections = [
    {
      title: '암관련보장',
      fields: [
        { id: 'C5', label: '일반암진단비' },
        { id: 'C6', label: '통합암진단비' },
        { id: 'C7', label: '전이암진단비' },
        { id: 'C8', label: '암특정치료비' },
        { id: 'C9', label: '암특정치료비(비급여)' },
        { id: 'C10', label: '표적항암치료비' }
      ]
    },
    {
      title: '뇌혈관/심장관련보장',
      fields: [
        { id: 'G5', label: '뇌혈관질환진단비' },
        { id: 'G6', label: '뇌졸중진단비' },
        { id: 'G7', label: '허혈성심장질환진단비' },
        { id: 'G8', label: '심근경색진단비' },
        { id: 'G16', label: '주요순환계(수술)' }
      ]
    },
    {
      title: '의료실비/운전자보장',
      fields: [
        { id: 'J5', label: '질병입원한도' },
        { id: 'J6', label: '질병통원한도' },
        { id: 'J11', label: '형사합의금' },
        { id: 'J12', label: '변호사선임비' }
      ]
    }
  ];
  
  sections.forEach(section => {
    // 섹션 헤더
    ctx.fillStyle = '#333';
    ctx.font = 'bold 20px Arial';
    ctx.textAlign = 'left';
    ctx.fillText(section.title, 50, yPos);
    
    // 섹션 라인
    ctx.strokeStyle = '#ff7f00';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(50, yPos + 5);
    ctx.lineTo(250, yPos + 5);
    ctx.stroke();
    
    yPos += 40;
    
    // 필드들 표시
    section.fields.forEach(field => {
      const value = data.values[field.id] || 0;
      if (value > 0) {
        // 배경 박스
        ctx.fillStyle = '#f8f9fa';
        ctx.fillRect(50, yPos - 20, 700, 30);
        
        // 라벨
        ctx.fillStyle = '#333';
        ctx.font = '14px Arial';
        ctx.fillText(field.label, 70, yPos);
        
        // 값
        ctx.fillStyle = '#007bff';
        ctx.font = 'bold 14px Arial';
        ctx.textAlign = 'right';
        ctx.fillText(`${value.toLocaleString()}만원`, 730, yPos);
        ctx.textAlign = 'left';
        
        // 프로그레스 바
        const maxValue = Math.max(...Object.values(data.values));
        const barWidth = Math.min((value / maxValue) * 200, 200);
        
        let barColor = '#dc3545';
        if (value >= 1000) barColor = '#28a745';
        else if (value >= 300) barColor = '#ffc107';
        
        ctx.fillStyle = barColor;
        ctx.fillRect(500, yPos - 15, barWidth, 10);
        
        yPos += 35;
      }
    });
    
    yPos += 30;
  });
  
  // 푸터
  ctx.fillStyle = '#666';
  ctx.font = '12px Arial';
  ctx.textAlign = 'center';
  ctx.fillText('본 자료는 보험 가입 현황을 요약한 것으로, 실제 보장내용과 차이가 있을 수 있습니다.', canvas.width / 2, canvas.height - 30);
  
  // 이미지 다운로드
  canvas.toBlob(function(blob) {
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${data.customerName}_보장분석_${new Date().toISOString().slice(0,10).replace(/-/g, '')}.png`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showMessage('전문적인 보고서 이미지가 다운로드되었습니다!', 'success');
  }, 'image/png');
}

// 데이터 불러오기
function loadData(id) {
  const data = savedData.find(item => item.id === id);
  if (!data) {
    showMessage('데이터를 찾을 수 없습니다.', 'error');
    return;
  }
  
  // 고객명 설정
  document.getElementById('customerName').value = data.customerName;
  
  // 모든 필드 값 설정
  Object.keys(data.values).forEach(fieldId => {
    const field = document.getElementById(fieldId);
    if (field) {
      field.value = data.values[fieldId];
    }
  });
  
  // 계산 필드 업데이트
  setupFormCalculations();
  updateCalculatedFields();
  applyConditionalFormatting();
  
  navigateToScreen('input');
  showMessage(`${data.customerName}의 데이터를 불러왔습니다.`, 'success');
}

// 저장된 목록 표시
function displaySavedList() {
  const savedList = document.getElementById('savedList');
  
  if (savedData.length === 0) {
    savedList.innerHTML = '<div class="meta">저장된 보장분석이 없습니다.</div>';
    return;
  }
  
  savedList.innerHTML = savedData.map(item => `
    <div class="saved-item" onclick="loadData(${item.id})">
      <div class="saved-item-title">${item.customerName}님의 보장분석</div>
      <div class="saved-item-date">${item.timestamp}</div>
    </div>
  `).join('');
}

// 메시지 표시
function showMessage(message, type = 'info') {
  const statusMessage = document.getElementById('statusMessage');
  statusMessage.textContent = message;
  statusMessage.className = `meta ${type}`;
  
  setTimeout(() => {
    statusMessage.textContent = '';
    statusMessage.className = 'meta';
  }, 3000);
}

// 이벤트 리스너 설정
document.addEventListener('DOMContentLoaded', () => {
  // 메뉴 버튼들
  document.getElementById('inputMenuBtn').addEventListener('click', () => navigateToScreen('input'));
  document.getElementById('loadMenuBtn').addEventListener('click', () => navigateToScreen('load'));
  
  // 입력 화면 버튼들
  document.getElementById('saveImageBtn').addEventListener('click', saveData);
  document.getElementById('loadFromMenuBtn').addEventListener('click', () => navigateToScreen('load'));
  document.getElementById('backToMenuBtn').addEventListener('click', () => navigateToScreen('menu'));
  
  // 불러오기 화면 버튼들
  document.getElementById('backToMenuFromLoadBtn').addEventListener('click', () => navigateToScreen('menu'));
  
  // 초기 화면 설정
  navigateToScreen('menu');
});
</script>

</body>
</html>
