<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>보장분석 앱</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,">
  <style>
    :root{
      --hanwha:#ff7f00;
      --hanwha-dark:#e67100;
      --bg:#f8f9fa;
      --card:#ffffff;
      --text:#333;
      --muted:#777;
      --border:#e6e6e6;
    }
    
    *{box-sizing:border-box}
    body{
      margin:0;
      padding-top: 70px;
      font-family: Arial, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    
    .header-fixed {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      background: var(--bg);
      border-bottom: 2px solid #ccc;
      padding: 8px 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,.08);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .logo-container {
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-block;
    }
    
    .logo-container:hover {
      transform: scale(1.05);
    }
    
    .logo-main {
      font-size: 32px;
      font-weight: 900;
      color: var(--hanwha);
      letter-spacing: 3px;
      text-shadow: 0 2px 4px rgba(255,127,0,0.2);
      margin: 0;
      line-height: 1;
    }
    
    .screen{
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      padding:2rem 1rem;
    }
    
    .app-title{
      font-size:24px;
      font-weight:700;
      color:var(--hanwha);
      margin-bottom:2rem;
      text-align:center;
    }
    
    .card{
      width:100%;
      max-width:520px;
      background:var(--card);
      border-radius:16px;
      box-shadow:0 6px 18px rgba(0,0,0,.08);
      padding:20px;
      margin-bottom:20px;
    }
    
    h2{margin:0 0 .75rem 0}
    .row{margin-bottom:.75rem}
    
    input, select{
      width:100%;
      padding:12px 14px;
      border:1px solid var(--border);
      border-radius:10px;
      font-size:16px;
      outline:none;
      background:#fff;
      text-align:right;
    }
    
    input.customer-name{
      text-align:left;
    }
    
    input:focus, select:focus{border-color:var(--hanwha)}
    
    button{
      width:100%;
      padding:12px 14px;
      background:var(--hanwha);
      color:#fff;
      border:none;
      border-radius:10px;
      font-weight:700;
      cursor:pointer;
      font-size:16px;
      margin-bottom:8px;
    }
    
    button:hover{background:var(--hanwha-dark)}
    
    button.secondary{
      background:#6c757d;
      margin-bottom:0;
    }
    
    button.secondary:hover{background:#545b62}
    
    .label{
      font-size:14px;
      font-weight:600;
      color:var(--text);
      margin-bottom:5px;
      display:block;
    }
    
    .unit{
      font-size:12px;
      color:var(--muted);
      margin-left:5px;
    }
    
    .section-title{
      font-size:18px;
      font-weight:700;
      color:var(--hanwha);
      margin:20px 0 15px 0;
      text-align:center;
      border-bottom:2px solid var(--hanwha);
      padding-bottom:8px;
    }
    
    .meta{
      color:var(--muted); 
      font-size:13px; 
      margin-top:.25rem;
      text-align:center;
    }
    
    .error{
      color:#d93025; 
      font-size:14px; 
      margin-top:.5rem;
      text-align:center;
    }
    
    .success{
      color:#28a745; 
      font-size:14px; 
      margin-top:.5rem;
      text-align:center;
    }
    
    .saved-item{
      background:#fff;
      border:1px solid var(--border);
      border-radius:12px;
      padding:16px;
      margin-bottom:12px;
      cursor:pointer;
      transition:all 0.2s ease;
    }
    
    .saved-item:hover{
      background:#f8f9fa;
      transform:translateY(-2px);
      box-shadow:0 4px 12px rgba(0,0,0,.1);
    }
    
    .saved-item-title{
      font-size:16px;
      font-weight:600;
      color:var(--text);
      margin-bottom:5px;
    }
    
    .saved-item-date{
      font-size:12px;
      color:var(--muted);
    }
    
    @media (max-width: 768px) {
      .card{
        max-width:100%;
        margin:0 10px 20px 10px;
      }
    }
    
    .calculated-field {
      background-color: #f0f8ff;
      border: 1px solid #b3d9ff;
    }
    
    .customer-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--hanwha);
      text-align: center;
      margin-bottom: 20px;
      padding: 15px;
      background: rgba(255,127,0,0.1);
      border-radius: 10px;
    }
    
    .preview-container {
      background: white;
      border: 2px solid var(--border);
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
      max-width: 100%;
      overflow: hidden;
    }
    
    .preview-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      margin-bottom: 10px;
    }
    
    .preview-table th, .preview-table td {
      border: 1px solid #ddd;
      padding: 8px 4px;
      text-align: center;
    }
    
    .preview-table th {
      background-color: var(--hanwha);
      color: white;
      font-weight: 600;
    }
    
    .preview-table .label-cell {
      text-align: left;
      font-weight: 600;
      background-color: #f8f9fa;
    }
    
    .preview-table .value-cell {
      text-align: right;
      font-weight: 600;
    }
    
    .input-section {
      margin-bottom: 30px;
    }
  </style>
</head>
<body>
  <div class="header-fixed">
    <div class="logo-container" onclick="goHome()">
      <div class="logo-main">보장분석</div>
    </div>
  </div>

  <!-- 메뉴 화면 -->
  <section id="menuScreen" class="screen">
    <div class="app-title">보장분석 앱</div>
    <div class="card">
      <h2 style="margin-bottom:1.5rem;">메뉴 선택</h2>
      
      <button id="inputMenuBtn" style="margin-bottom:1rem;">
        <span style="font-size:18px; display:block; margin-bottom:4px;">입력하기</span>
        <span style="font-size:14px; opacity:0.8;">새로운 보장분석 작성</span>
      </button>
      
      <button id="loadMenuBtn" style="margin-bottom:1rem;">
        <span style="font-size:18px; display:block; margin-bottom:4px;">불러오기</span>
        <span style="font-size:14px; opacity:0.8;">저장된 보장분석 불러오기</span>
      </button>

      <div class="meta" style="margin-top:2rem;">Copyright 2025 보장분석 앱</div>
    </div>
  </section>

  <!-- 입력 화면 -->
  <section id="inputScreen" class="screen" style="display:none;">
    <div class="app-title">보장분석 입력</div>
    
    <div class="card">
      <div class="row">
        <label class="label">고객명</label>
        <input id="customerName" type="text" placeholder="고객명을 입력하세요" class="customer-name">
      </div>
    </div>

    <!-- 암 관련 보장 섹션 -->
    <div class="card">
      <div class="section-title">암 관련 보장</div>
      <div class="input-section">
        
        <div class="row">
          <label class="label">일반암진단비 <span class="unit">(만원)</span></label>
          <input type="number" id="C5" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">통합암진단비 <span class="unit">(만원)</span></label>
          <input type="number" id="C6" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">전이암진단비 <span class="unit">(만원)</span></label>
          <input type="number" id="C7" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">암특정치료비 <span class="unit">(만원)</span></label>
          <input type="number" id="C8" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">암특정치료비(비급여) <span class="unit">(만원)</span></label>
          <input type="number" id="C9" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">표적항암치료비 <span class="unit">(만원)</span></label>
          <input type="number" id="C10" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">중입자치료비 <span class="unit">(만원)</span></label>
          <input type="number" id="C11" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">암수술비 <span class="unit">(만원)</span></label>
          <input type="number" id="C12" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">다빈치로봇수술비 <span class="unit">(만원)</span></label>
          <input type="number" id="C13" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">1-5종수술비(5종) <span class="unit">(만원)</span></label>
          <input type="number" id="C14" placeholder="0" data-formula="">
        </div>
        
      </div>
    </div>

    <!-- 뇌혈관/심장 관련 보장 섹션 -->
    <div class="card">
      <div class="section-title">뇌혈관/심장 관련 보장</div>
      <div class="input-section">
        
        <div class="row">
          <label class="label">뇌혈관질환진단비 <span class="unit">(만원)</span></label>
          <input type="number" id="G5" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">뇌졸중진단비 <span class="unit">(만원)</span></label>
          <input type="number" id="G6" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">허혈성심장질환진단비 <span class="unit">(만원)</span></label>
          <input type="number" id="G7" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">심근경색진단비 <span class="unit">(만원)</span></label>
          <input type="number" id="G8" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">뇌혈관질환수술비 <span class="unit">(만원)</span></label>
          <input type="number" id="G9" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">뇌졸중수술비 <span class="unit">(만원)</span></label>
          <input type="number" id="G10" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">허혈성심장질환수술비 <span class="unit">(만원)</span></label>
          <input type="number" id="G11" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">심근경색수술비 <span class="unit">(만원)</span></label>
          <input type="number" id="G12" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">뇌졸중혈전용해 <span class="unit">(만원)</span></label>
          <input type="number" id="G13" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">심근경색혈전용해 <span class="unit">(만원)</span></label>
          <input type="number" id="G14" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">2대특정치료비 <span class="unit">(만원)</span></label>
          <input type="number" id="G15" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">주요순환계(수술) <span class="unit">(만원)</span></label>
          <input type="number" id="G16" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">주요순환계(혈전제거) <span class="unit">(만원)</span></label>
          <input type="number" id="G17" placeholder="0" data-formula="G16" class="calculated-field" readonly>
        </div>
        
        <div class="row">
          <label class="label">주요순환계(혈전용해) <span class="unit">(만원)</span></label>
          <input type="number" id="G18" placeholder="0" data-formula="G16" class="calculated-field" readonly>
        </div>
        
        <div class="row">
          <label class="label">주요순환계(중환자실) <span class="unit">(만원)</span></label>
          <input type="number" id="G19" placeholder="0" data-formula="G16/2" class="calculated-field" readonly>
        </div>
        
        <div class="row">
          <label class="label">혈전제거치료비 <span class="unit">(만원)</span></label>
          <input type="number" id="G20" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">1-5종수술비(3종) <span class="unit">(만원)</span></label>
          <input type="number" id="G21" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">1-5종수술비(5종) <span class="unit">(만원)</span></label>
          <input type="number" id="G22" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">124대질병수술비(특정10대) <span class="unit">(만원)</span></label>
          <input type="number" id="G23" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">7대기관수술비(뇌/심) 관혈 <span class="unit">(만원)</span></label>
          <input type="number" id="G24" placeholder="0" data-formula="">
        </div>
        
      </div>
    </div>

    <!-- 기타 보장 섹션 -->
    <div class="card">
      <div class="section-title">기타 보장</div>
      <div class="input-section">
        
        <div class="row">
          <label class="label">(질병)입원한도 <span class="unit">(만원)</span></label>
          <input type="number" id="J5" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">(질병)통원한도 <span class="unit">(일)</span></label>
          <input type="number" id="J6" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">(상해)입원한도 <span class="unit">(만원)</span></label>
          <input type="number" id="J7" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">(상해)통원한도 <span class="unit">(일)</span></label>
          <input type="number" id="J8" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">형사합의금 <span class="unit">(만원)</span></label>
          <input type="number" id="J11" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">변호사선임비 <span class="unit">(만원)</span></label>
          <input type="number" id="J12" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">요양병원 외 <span class="unit">(만원)</span></label>
          <input type="number" id="J16" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">요양병원 <span class="unit">(만원)</span></label>
          <input type="number" id="J17" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">간호간병통합 <span class="unit">(만원)</span></label>
          <input type="number" id="J18" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">생활비 지원 <span class="unit">(만원)</span></label>
          <input type="number" id="I21" placeholder="0" data-formula="">
        </div>
        
        <div class="row">
          <label class="label">기타 보장 <span class="unit">(만원)</span></label>
          <input type="number" id="I24" placeholder="0" data-formula="">
        </div>
        
      </div>
    </div>

    <!-- 버튼 영역 -->
    <div class="card">
      <button id="saveImageBtn">이미지로 저장하기</button>
      <button id="loadFromMenuBtn" class="secondary">불러오기</button>
      <button id="backToMenuBtn" class="secondary">뒤로가기</button>
      
      <div id="statusMessage" class="meta"></div>
    </div>
  </section>

  <!-- 불러오기 화면 -->
  <section id="loadScreen" class="screen" style="display:none;">
    <div class="app-title">저장된 보장분석</div>
    <div class="card">
      <h2 style="margin-bottom:1rem;">저장된 목록</h2>
      <div id="savedList">
        <!-- 저장된 항목들이 여기에 표시됩니다 -->
      </div>
      <button id="backToMenuFromLoadBtn" class="secondary" style="margin-top:20px;">뒤로가기</button>
    </div>
  </section>

<script>
let currentScreen = 'menu';
let savedData = JSON.parse(localStorage.getItem('insuranceAnalysisData')) || [];

// 화면 전환 함수
function hideAllScreens() {
  document.getElementById("menuScreen").style.display = "none";
  document.getElementById("inputScreen").style.display = "none";
  document.getElementById("loadScreen").style.display = "none";
}

function navigateToScreen(screen) {
  currentScreen = screen;
  hideAllScreens();
  
  switch(screen) {
    case 'menu':
      document.getElementById("menuScreen").style.display = "flex";
      break;
    case 'input':
      document.getElementById("inputScreen").style.display = "flex";
      setupFormCalculations();
      break;
    case 'load':
      document.getElementById("loadScreen").style.display = "flex";
      displaySavedList();
      break;
  }
}

// 홈으로 이동
function goHome() {
  navigateToScreen('menu');
}

// 계산 필드 설정
function setupFormCalculations() {
  // G16 값이 변경될 때 G17, G18, G19 자동 계산
  const g16Input = document.getElementById('G16');
  const g17Input = document.getElementById('G17');
  const g18Input = document.getElementById('G18');
  const g19Input = document.getElementById('G19');
  
  g16Input.addEventListener('input', function() {
    const value = parseFloat(this.value) || 0;
    g17Input.value = value;
    g18Input.value = value;
    g19Input.value = value / 2;
  });
}

// 데이터 저장
function saveData() {
  const customerName = document.getElementById('customerName').value.trim();
  
  if (!customerName) {
    showMessage('고객명을 입력해주세요.', 'error');
    return;
  }
  
  const data = {
    id: Date.now(),
    customerName: customerName,
    timestamp: new Date().toLocaleString('ko-KR'),
    values: {}
  };
  
  // 모든 입력 필드 값 저장
  const inputFields = [
    'C5', 'C6', 'C7', 'C8', 'C9', 'C10', 'C11', 'C12', 'C13', 'C14',
    'G5', 'G6', 'G7', 'G8', 'G9', 'G10', 'G11', 'G12', 'G13', 'G14', 'G15', 'G16', 'G17', 'G18', 'G19', 'G20', 'G21', 'G22', 'G23', 'G24',
    'J5', 'J6', 'J7', 'J8', 'J11', 'J12', 'J16', 'J17', 'J18', 'I21', 'I24'
  ];
  
  inputFields.forEach(fieldId => {
    const field = document.getElementById(fieldId);
    if (field) {
      data.values[fieldId] = parseFloat(field.value) || 0;
    }
  });
  
  // 기존 데이터에서 같은 고객명 찾아서 업데이트 또는 새로 추가
  const existingIndex = savedData.findIndex(item => item.customerName === customerName);
  if (existingIndex >= 0) {
    savedData[existingIndex] = data;
  } else {
    savedData.push(data);
  }
  
  localStorage.setItem('insuranceAnalysisData', JSON.stringify(savedData));
  
  showMessage('저장되었습니다!', 'success');
  
  // 이미지 생성 및 다운로드
  generateAndDownloadImage(data);
}

// 데이터 불러오기
function loadData(id) {
  const data = savedData.find(item => item.id === id);
  if (!data) {
    showMessage('데이터를 찾을 수 없습니다.', 'error');
    return;
  }
  
  // 고객명 설정
  document.getElementById('customerName').value = data.customerName;
  
  // 모든 필드 값 설정
  Object.keys(data.values).forEach(fieldId => {
    const field = document.getElementById(fieldId);
    if (field) {
      field.value = data.values[fieldId];
    }
  });
  
  // 계산 필드 업데이트
  setupFormCalculations();
  const event = new Event('input');
  document.getElementById('G16').dispatchEvent(event);
  
  navigateToScreen('input');
  showMessage(`${data.customerName}의 데이터를 불러왔습니다.`, 'success');
}

// 저장된 목록 표시
function displaySavedList() {
  const savedList = document.getElementById('savedList');
  
  if (savedData.length === 0) {
    savedList.innerHTML = '<div class="meta">저장된 보장분석이 없습니다.</div>';
    return;
  }
  
  savedList.innerHTML = savedData.map(item => `
    <div class="saved-item" onclick="loadData(${item.id})">
      <div class="saved-item-title">${item.customerName}님의 보장분석</div>
      <div class="saved-item-date">${item.timestamp}</div>
    </div>
  `).join('');
}

// 메시지 표시
function showMessage(message, type = 'info') {
  const statusMessage = document.getElementById('statusMessage');
  statusMessage.textContent = message;
  statusMessage.className = `meta ${type}`;
  
  setTimeout(() => {
    statusMessage.textContent = '';
    statusMessage.className = 'meta';
  }, 3000);
}

// 이미지 생성 및 다운로드
function generateAndDownloadImage(data) {
  // Canvas 생성
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  
  // 캔버스 크기 설정 (A4 비율)
  canvas.width = 800;
  canvas.height = 1200;
  
  // 배경 설정
  ctx.fillStyle = '#ffffff';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  // 제목
  ctx.fillStyle = '#ff7f00';
  ctx.font = 'bold 28px Arial';
  ctx.textAlign = 'center';
  ctx.fillText(`${data.customerName}님의 한 장 요약 보장분석`, canvas.width / 2, 50);
  
  // 구분선
  ctx.strokeStyle = '#ff7f00';
  ctx.lineWidth = 3;
  ctx.beginPath();
  ctx.moveTo(50, 70);
  ctx.lineTo(canvas.width - 50, 70);
  ctx.stroke();
  
  let yPos = 120;
  
  // 섹션별 데이터 표시
  const sections = [
    {
      title: '암 관련 보장',
      fields: [
        { id: 'C5', label: '일반암진단비', unit: '만원' },
        { id: 'C6', label: '통합암진단비', unit: '만원' },
        { id: 'C7', label: '전이암진단비', unit: '만원' },
        { id: 'C8', label: '암특정치료비', unit: '만원' },
        { id: 'C9', label: '암특정치료비(비급여)', unit: '만원' },
        { id: 'C10', label: '표적항암치료비', unit: '만원' },
        { id: 'C11', label: '중입자치료비', unit: '만원' },
        { id: 'C12', label: '암수술비', unit: '만원' },
        { id: 'C13', label: '다빈치로봇수술비', unit: '만원' },
        { id: 'C14', label: '1-5종수술비(5종)', unit: '만원' }
      ]
    },
    {
      title: '뇌혈관/심장 관련 보장',
      fields: [
        { id: 'G5', label: '뇌혈관질환진단비', unit: '만원' },
        { id: 'G6', label: '뇌졸중진단비', unit: '만원' },
        { id: 'G7', label: '허혈성심장질환진단비', unit: '만원' },
        { id: 'G8', label: '심근경색진단비', unit: '만원' },
        { id: 'G11', label: '허혈성심장질환수술비', unit: '만원' },
        { id: 'G16', label: '주요순환계(수술)', unit: '만원' },
        { id: 'G21', label: '1-5종수술비(3종)', unit: '만원' },
        { id: 'G22', label: '1-5종수술비(5종)', unit: '만원' },
        { id: 'G23', label: '124대질병수술비(특정10대)', unit: '만원' },
        { id: 'G24', label: '7대기관수술비(뇌/심) 관혈', unit: '만원' }
      ]
    },
    {
      title: '기타 보장',
      fields: [
        { id: 'J5', label: '(질병)입원한도', unit: '만원' },
        { id: 'J6', label: '(질병)통원한도', unit: '일' },
        { id: 'J7', label: '(상해)입원한도', unit: '만원' },
        { id: 'J8', label: '(상해)통원한도', unit: '일' },
        { id: 'J11', label: '형사합의금', unit: '만원' },
        { id: 'J12', label: '변호사선임비', unit: '만원' },
        { id: 'J16', label: '요양병원 외', unit: '만원' },
        { id: 'J17', label: '요양병원', unit: '만원' },
        { id: 'J18', label: '간호간병통합', unit: '만원' },
        { id: 'I21', label: '생활비 지원', unit: '만원' }
      ]
    }
  ];
  
  sections.forEach(section => {
    // 섹션 제목
    ctx.fillStyle = '#ff7f00';
    ctx.font = 'bold 20px Arial';
    ctx.textAlign = 'left';
    ctx.fillText(section.title, 50, yPos);
    yPos += 35;
    
    // 구분선
    ctx.strokeStyle = '#ff7f00';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(50, yPos - 10);
    ctx.lineTo(canvas.width - 50, yPos - 10);
    ctx.stroke();
    
    // 필드별 데이터
    ctx.fillStyle = '#333';
    ctx.font = '16px Arial';
    
    section.fields.forEach(field => {
      const value = data.values[field.id] || 0;
      if (value > 0) {
        ctx.textAlign = 'left';
        ctx.fillText(field.label, 70, yPos);
        ctx.textAlign = 'right';
        ctx.fillText(`${value.toLocaleString()} ${field.unit}`, canvas.width - 70, yPos);
        yPos += 25;
      }
    });
    
    yPos += 20;
  });
  
  // 생성 일시
  ctx.fillStyle = '#666';
  ctx.font = '12px Arial';
  ctx.textAlign = 'center';
  ctx.fillText(`생성일시: ${data.timestamp}`, canvas.width / 2, canvas.height - 30);
  
  // 이미지 다운로드
  canvas.toBlob(function(blob) {
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${data.customerName}_보장분석_${new Date().getFullYear()}${String(new Date().getMonth() + 1).padStart(2, '0')}${String(new Date().getDate()).padStart(2, '0')}.png`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }, 'image/png');
}

// 이벤트 리스너 설정
document.addEventListener('DOMContentLoaded', () => {
  // 메뉴 버튼들
  document.getElementById('inputMenuBtn').addEventListener('click', () => navigateToScreen('input'));
  document.getElementById('loadMenuBtn').addEventListener('click', () => navigateToScreen('load'));
  
  // 입력 화면 버튼들
  document.getElementById('saveImageBtn').addEventListener('click', saveData);
  document.getElementById('loadFromMenuBtn').addEventListener('click', () => navigateToScreen('load'));
  document.getElementById('backToMenuBtn').addEventListener('click', () => navigateToScreen('menu'));
  
  // 불러오기 화면 버튼들
  document.getElementById('backToMenuFromLoadBtn').addEventListener('click', () => navigateToScreen('menu'));
  
  // 초기 화면 설정
  navigateToScreen('menu');
});

</script>

</body>
</html>
