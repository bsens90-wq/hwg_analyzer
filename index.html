<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>보장분석지</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        /* 네비게이션 */
        .nav-steps {
            display: flex;
            background: #f8f9fa;
            padding: 10px 0;
            justify-content: center;
            flex-wrap: wrap;
        }

        .nav-step {
            padding: 8px 16px;
            margin: 0 5px;
            border-radius: 20px;
            font-size: 14px;
            white-space: nowrap;
        }

        .nav-step.active {
            background: #c62828;
            color: white;
        }

        .nav-step:not(.active) {
            background: white;
            border: 1px solid #ddd;
        }

        /* 헤더 */
        .header {
            padding: 20px;
            border-bottom: 2px solid #eee;
        }

        .title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .legend {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .info-row {
            display: flex;
            gap: 30px;
            font-size: 14px;
            flex-wrap: wrap;
        }

        .info-item {
            display: flex;
            gap: 5px;
        }

        /* 업로드 섹션 */
        .upload-section {
            padding: 20px;
            border-bottom: 1px solid #eee;
            background: #f9f9f9;
        }

        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background: white;
            transition: all 0.3s;
        }

        .upload-area:hover {
            border-color: #c62828;
            background: #fafafa;
        }

        .upload-area input[type="file"] {
            display: none;
        }

        .upload-btn {
            background: #c62828;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }

        .upload-btn:hover {
            background: #a52525;
        }

        /* 메인 콘텐츠 */
        .main-content {
            padding: 20px;
        }

        .sections-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .section {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            background: white;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
        }

        .score-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 16px;
            position: relative;
        }

        .score-circle::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(from 0deg, #4caf50 0deg, #4caf50 var(--score-deg), #e0e0e0 var(--score-deg), #e0e0e0 360deg);
        }

        .score-circle span {
            position: relative;
            z-index: 1;
            background: white;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
            font-size: 14px;
        }

        .item {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 6px;
            background: #f9f9f9;
        }

        .item-name {
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }

        .item-amounts {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .amount-input {
            width: 80px;
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: right;
            font-size: 12px;
        }

        .amount-display {
            font-size: 13px;
            color: #666;
        }

        .shortage {
            color: #c62828;
            font-weight: bold;
            font-size: 12px;
        }

        .sufficient {
            color: #4caf50;
            font-weight: bold;
            font-size: 12px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin-top: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.3s;
        }

        /* 생활보장 스타일 */
        .lifestyle-section {
            grid-column: 1 / -1;
        }

        .lifestyle-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .lifestyle-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-radius: 6px;
            background: #f9f9f9;
        }

        .status-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }

        .status-o { background: #4caf50; }
        .status-triangle { background: #ff9800; }
        .status-x { background: #f44336; }

        /* 반응형 */
        @media (max-width: 768px) {
            .sections-container {
                grid-template-columns: 1fr;
            }
            
            .info-row {
                flex-direction: column;
                gap: 10px;
            }
            
            .nav-steps {
                overflow-x: auto;
                justify-content: flex-start;
                padding: 10px;
            }
        }

        .edit-mode {
            background: #fff3cd !important;
            border: 1px solid #ffc107 !important;
        }

        /* 결과 이미지 생성 버튼 */
        .action-buttons {
            padding: 20px;
            text-align: center;
            border-top: 1px solid #eee;
            background: #f9f9f9;
        }

        .generate-btn {
            background: #2196F3;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 0 10px;
            transition: all 0.3s;
        }

        .generate-btn:hover {
            background: #1976D2;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        /* 숨겨진 출력용 캔버스 */
        .output-canvas {
            position: absolute;
            left: -9999px;
            top: -9999px;
        }

        /* 원본 스타일의 보장분석지 */
        .original-layout {
            width: 1200px;
            height: 800px;
            background: white;
            font-family: 'Malgun Gothic', sans-serif;
            position: relative;
            box-sizing: border-box;
            padding: 20px;
        }

        .original-nav {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
            gap: 10px;
        }

        .original-nav-item {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            color: #666;
            border: 1px solid #ddd;
        }

        .original-nav-item.active {
            background: #c62828;
            color: white;
            border-color: #c62828;
        }

        .original-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: left;
        }

        .original-legend {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
            font-size: 11px;
        }

        .original-legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .original-legend-color {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .original-info {
            display: flex;
            gap: 20px;
            font-size: 12px;
            margin-bottom: 20px;
        }

        .original-main {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 15px;
            height: 500px;
        }

        .original-section {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: white;
            display: flex;
            flex-direction: column;
        }

        .original-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .original-section-title {
            font-size: 16px;
            font-weight: bold;
        }

        .original-score {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            color: white;
            position: relative;
        }

        .original-items {
            flex: 1;
            overflow-y: auto;
        }

        .original-item {
            margin-bottom: 8px;
            font-size: 10px;
            line-height: 1.3;
        }

        .original-item-name {
            font-weight: bold;
            margin-bottom: 3px;
            color: #333;
        }

        .original-item-amount {
            color: #666;
        }

        .original-shortage {
            color: #c62828;
            font-weight: bold;
        }

        .original-bar {
            width: 100%;
            height: 4px;
            background: #e0e0e0;
            border-radius: 2px;
            margin-top: 2px;
            overflow: hidden;
        }

        .original-bar-fill {
            height: 100%;
        }

        .original-lifestyle {
            grid-column: 1 / -1;
            height: 120px;
        }

        .original-lifestyle-items {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            height: 80px;
        }

        .original-lifestyle-item {
            font-size: 9px;
            text-align: center;
            padding: 5px;
            border-radius: 4px;
            background: #f9f9f9;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .original-status {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: white;
            font-weight: bold;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 네비게이션 -->
        <div class="nav-steps">
            <div class="nav-step">1. 컨설팅 가이드</div>
            <div class="nav-step active">2. 간편분석</div>
            <div class="nav-step">3. 계약상세</div>
            <div class="nav-step">4. 주요보장</div>
            <div class="nav-step">5. 예상보험금 조회</div>
            <div class="nav-step">6. 컨설팅 결과</div>
            <div class="nav-step">7. 전/후비교</div>
        </div>

        <!-- 헤더 -->
        <div class="header">
            <div class="title" id="title">손덕령님의 한 장 요약 보장분석</div>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #4caf50;"></div>
                    <span>100% 이상</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #ff9800;"></div>
                    <span>80% 이상</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f44336;"></div>
                    <span>30% 미만</span>
                </div>
            </div>
            <div class="info-row" id="info-row">
                <div class="info-item">
                    <span>생년월일</span>
                    <span id="birth-date">73-12-19</span>
                </div>
                <div class="info-item">
                    <span>/</span>
                    <span>상령일</span>
                    <span id="age-date">06-18</span>
                </div>
                <div class="info-item">
                    <span>/</span>
                    <span>손해보험</span>
                    <span id="damage-insurance">3</span>건
                </div>
                <div class="info-item">
                    <span>/</span>
                    <span>생명보험</span>
                    <span id="life-insurance">7</span>건
                </div>
                <div class="info-item">
                    <span>/</span>
                    <span>월납보험료 합계</span>
                    <span id="monthly-premium">563,810</span>원
                </div>
            </div>
        </div>

        <!-- 업로드 섹션 -->
        <div class="upload-section">
            <div class="upload-area" onclick="document.getElementById('file-input').click()">
                <input type="file" id="file-input" accept="image/*" onchange="handleFileUpload(event)">
                <div>
                    <h3>보장분석지 이미지를 업로드하세요</h3>
                    <p>클릭하거나 파일을 드래그해서 업로드</p>
                    <button class="upload-btn" type="button">파일 선택</button>
                </div>
            </div>
        </div>

        <!-- 메인 콘텐츠 -->
        <div class="main-content">
            <div class="sections-container" id="sections-container">
                <!-- 가족보장 -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">가족보장</div>
                        <div class="score-circle" style="--score-deg: 190.8deg;">
                            <span id="family-score">53점</span>
                        </div>
                    </div>
                    <div id="family-items">
                        <!-- 동적으로 생성 -->
                    </div>
                </div>

                <!-- 큰병보장 -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">큰병보장</div>
                        <div class="score-circle" style="--score-deg: 280.8deg;">
                            <span id="disease-score">78점</span>
                        </div>
                    </div>
                    <div id="disease-items">
                        <!-- 동적으로 생성 -->
                    </div>
                </div>

                <!-- 의료보장 -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">의료보장</div>
                        <div class="score-circle" style="--score-deg: 313.2deg;">
                            <span id="medical-score">87점</span>
                        </div>
                    </div>
                    <div id="medical-items">
                        <!-- 동적으로 생성 -->
                    </div>
                </div>

                <!-- 간병보장 -->
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">간병보장</div>
                        <div class="score-circle" style="--score-deg: 46.8deg;">
                            <span id="care-score">13점</span>
                        </div>
                    </div>
                    <div id="care-items">
                        <!-- 동적으로 생성 -->
                    </div>
                </div>

                <!-- 생활보장 -->
                <div class="section lifestyle-section">
                    <div class="section-header">
                        <div class="section-title">생활보장</div>
                        <div style="font-size: 12px; color: #666;">
                            <span style="color: #4caf50;">●</span> 적정
                            <span style="color: #ff9800; margin-left: 10px;">▲</span> 부족
                            <span style="color: #f44336; margin-left: 10px;">✕</span> 미보장
                        </div>
                    </div>
                    <div class="lifestyle-items" id="lifestyle-items">
                        <!-- 동적으로 생성 -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 액션 버튼들 -->
        <div class="action-buttons">
            <button class="generate-btn" onclick="generateOriginalLayout()">
                📊 원본 형태 보장분석지 생성
            </button>
            <button class="generate-btn" onclick="downloadAsImage()">
                💾 이미지로 다운로드
            </button>
        </div>
    </div>

    <!-- 숨겨진 원본 레이아웃 -->
    <div id="original-layout" class="original-layout output-canvas">
        <!-- 원본 형태의 보장분석지가 여기에 생성됩니다 -->
    </div>

    <script>
        // 기본 데이터
        const defaultData = {
            personal: {
                name: "손덕령",
                birthDate: "73-12-19",
                ageDate: "06-18",
                damageInsurance: 3,
                lifeInsurance: 7,
                monthlyPremium: 563810
            },
            sections: {
                family: {
                    score: 53,
                    items: [
                        { name: "질병사망", current: 3800, target: 10000 },
                        { name: "상해사망", current: 8200, target: 20000 },
                        { name: "질병후유(3%)", current: 2000, target: 3000 },
                        { name: "상해후유(3%)", current: 7000, target: 10000 }
                    ]
                },
                disease: {
                    score: 78,
                    items: [
                        { name: "유사암", current: 900, target: 1000 },
                        { name: "일반암", current: 3000, target: 7000 },
                        { name: "통합암", current: 0, target: 7000 },
                        { name: "표적항암약물", current: 0, target: 5000 },
                        { name: "뇌혈관질환", current: 1000, target: 2000 },
                        { name: "뇌졸중", current: 1000, target: 3000 },
                        { name: "허혈성심장질환", current: 1000, target: 2000 },
                        { name: "급성심근경색", current: 1000, target: 3000 }
                    ]
                },
                medical: {
                    score: 87,
                    items: [
                        { name: "질병입원 실손", current: 5000, target: 5000 },
                        { name: "상해입원 실손", current: 5000, target: 5000 },
                        { name: "질병입원(1일)", current: 10, target: 3 },
                        { name: "상해입원(1일)", current: 2, target: 3 },
                        { name: "질병수술비", current: 52, target: 50 },
                        { name: "상해수술비", current: 53, target: 150 }
                    ]
                },
                care: {
                    score: 13,
                    items: [
                        { name: "경증치매", current: 0, target: 2000 },
                        { name: "중증치매", current: 0, target: 4000 },
                        { name: "장기요양(4급)", current: 0, target: 2000 },
                        { name: "장기요양(1급)", current: 0, target: 4000 },
                        { name: "간병인상해입원", current: 0, target: 10 },
                        { name: "간병인질병입원", current: 0, target: 10 }
                    ]
                }
            },
            lifestyle: [
                { name: "대인형사합의지원금", amount: 20000, status: "O" },
                { name: "변호사선임비용", amount: 3000, status: "△" },
                { name: "운전자벌금", amount: 3500, status: "O" },
                { name: "자동차부상발생금", amount: 10, status: "△" },
                { name: "화재벌금", amount: 2000, status: "O" },
                { name: "일상생활배상책임", amount: 10000, status: "O" },
                { name: "임플란트", amount: 200, status: "O" }
            ]
        };

        let currentData = JSON.parse(JSON.stringify(defaultData));

        // 초기화
        function init() {
            updatePersonalInfo();
            renderSections();
            renderLifestyle();
        }

        // 개인정보 업데이트
        function updatePersonalInfo() {
            document.getElementById('title').textContent = `${currentData.personal.name}님의 한 장 요약 보장분석`;
            document.getElementById('birth-date').textContent = currentData.personal.birthDate;
            document.getElementById('age-date').textContent = currentData.personal.ageDate;
            document.getElementById('damage-insurance').textContent = currentData.personal.damageInsurance;
            document.getElementById('life-insurance').textContent = currentData.personal.lifeInsurance;
            document.getElementById('monthly-premium').textContent = currentData.personal.monthlyPremium.toLocaleString();
        }

        // 섹션 렌더링
        function renderSections() {
            const sections = ['family', 'disease', 'medical', 'care'];
            const sectionNames = ['가족보장', '큰병보장', '의료보장', '간병보장'];
            
            sections.forEach((sectionKey, index) => {
                const section = currentData.sections[sectionKey];
                const container = document.getElementById(`${sectionKey}-items`);
                const scoreElement = document.getElementById(`${sectionKey}-score`);
                
                // 점수 업데이트
                scoreElement.textContent = `${section.score}점`;
                updateScoreCircle(scoreElement.parentElement, section.score);
                
                // 아이템 렌더링
                container.innerHTML = '';
                section.items.forEach((item, itemIndex) => {
                    const itemElement = createItemElement(item, sectionKey, itemIndex);
                    container.appendChild(itemElement);
                });
            });
        }

        // 아이템 요소 생성
        function createItemElement(item, sectionKey, itemIndex) {
            const div = document.createElement('div');
            div.className = 'item';
            
            const shortage = Math.max(0, item.target - item.current);
            const percentage = Math.min(100, (item.current / item.target) * 100);
            
            let progressColor = '#f44336'; // 30% 미만
            if (percentage >= 100) progressColor = '#4caf50'; // 100% 이상
            else if (percentage >= 80) progressColor = '#ff9800'; // 80% 이상
            
            div.innerHTML = `
                <div class="item-name">${item.name}</div>
                <div class="item-amounts">
                    <input type="number" class="amount-input" value="${item.current}" 
                           onchange="updateAmount('${sectionKey}', ${itemIndex}, 'current', this.value)">
                    <span class="amount-display">만원 /</span>
                    <input type="number" class="amount-input" value="${item.target}" 
                           onchange="updateAmount('${sectionKey}', ${itemIndex}, 'target', this.value)">
                    <span class="amount-display">만원</span>
                    ${shortage > 0 ? `<span class="shortage">(${shortage.toLocaleString()}만원 부족)</span>` : 
                      item.current >= item.target ? `<span class="sufficient">충족</span>` : ''}
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${Math.min(100, percentage)}%; background: ${progressColor};"></div>
                </div>
            `;
            
            return div;
        }

        // 점수 원형 그래프 업데이트
        function updateScoreCircle(element, score) {
            const degrees = (score / 100) * 360;
            element.style.setProperty('--score-deg', `${degrees}deg`);
        }

        // 생활보장 렌더링
        function renderLifestyle() {
            const container = document.getElementById('lifestyle-items');
            container.innerHTML = '';
            
            currentData.lifestyle.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'lifestyle-item';
                
                const statusClass = item.status === 'O' ? 'status-o' : 
                                   item.status === '△' ? 'status-triangle' : 'status-x';
                const statusText = item.status === 'O' ? '●' : 
                                  item.status === '△' ? '▲' : '✕';
                
                div.innerHTML = `
                    <div>
                        <strong>${item.name}</strong>
                        <div style="font-size: 12px; color: #666; margin-top: 2px;">
                            <input type="number" class="amount-input" value="${item.amount}" 
                                   onchange="updateLifestyle(${index}, 'amount', this.value)">만원
                        </div>
                    </div>
                    <div class="status-indicator ${statusClass}" onclick="toggleStatus(${index})">${statusText}</div>
                `;
                
                container.appendChild(div);
            });
        }

        // 금액 업데이트
        function updateAmount(sectionKey, itemIndex, field, value) {
            const numValue = parseInt(value) || 0;
            currentData.sections[sectionKey].items[itemIndex][field] = numValue;
            
            // 점수 재계산 (간단한 예시)
            const section = currentData.sections[sectionKey];
            const totalPercentage = section.items.reduce((sum, item) => {
                return sum + Math.min(100, (item.current / item.target) * 100);
            }, 0);
            section.score = Math.round(totalPercentage / section.items.length);
            
            renderSections();
        }

        // 생활보장 업데이트
        function updateLifestyle(index, field, value) {
            currentData.lifestyle[index][field] = field === 'amount' ? (parseInt(value) || 0) : value;
            renderLifestyle();
        }

        // 상태 토글
        function toggleStatus(index) {
            const statuses = ['O', '△', '✕'];
            const currentStatus = currentData.lifestyle[index].status;
            const currentIndex = statuses.indexOf(currentStatus);
            const nextIndex = (currentIndex + 1) % statuses.length;
            currentData.lifestyle[index].status = statuses[nextIndex];
            renderLifestyle();
        }

        // 파일 업로드 처리
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // 여기서 OCR 처리를 시뮬레이션
            alert('OCR 기능은 실제 구현에서 Tesseract.js 등을 사용하여 구현할 수 있습니다.\n현재는 기본 데이터를 사용합니다.');
            
            // 실제로는 여기서 OCR 결과를 파싱하여 currentData를 업데이트
            // parseOCRResult(ocrText);
        }

        // 드래그 앤 드롭 이벤트
        document.addEventListener('DOMContentLoaded', function() {
            const uploadArea = document.querySelector('.upload-area');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
                document.body.addEventListener(eventName, preventDefaults, false);
            });
            
            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, unhighlight, false);
            });
            
            uploadArea.addEventListener('drop', handleDrop, false);
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            function highlight(e) {
                uploadArea.style.borderColor = '#c62828';
                uploadArea.style.background = '#fafafa';
            }
            
            function unhighlight(e) {
                uploadArea.style.borderColor = '#ccc';
                uploadArea.style.background = 'white';
            }
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length > 0) {
                    document.getElementById('file-input').files = files;
                    handleFileUpload({ target: { files: files } });
                }
            }
        });

        // 초기화 실행
        init();

        // 원본 레이아웃 생성
        function generateOriginalLayout() {
            const container = document.getElementById('original-layout');
            container.innerHTML = '';

            // 네비게이션
            const nav = document.createElement('div');
            nav.className = 'original-nav';
            nav.innerHTML = `
                <div class="original-nav-item">1. 컨설팅 가이드</div>
                <div class="original-nav-item active">2. 간편분석</div>
                <div class="original-nav-item">3. 계약상세</div>
                <div class="original-nav-item">4. 주요보장</div>
                <div class="original-nav-item">5. 예상보험금 조회</div>
                <div class="original-nav-item">6. 컨설팅 결과</div>
                <div class="original-nav-item">7. 전/후비교</div>
            `;
            container.appendChild(nav);

            // 제목
            const title = document.createElement('div');
            title.className = 'original-title';
            title.textContent = `${currentData.personal.name}님의 한 장 요약 보장분석`;
            container.appendChild(title);

            // 범례
            const legend = document.createElement('div');
            legend.className = 'original-legend';
            legend.innerHTML = `
                <div class="original-legend-item">
                    <div class="original-legend-color" style="background: #4caf50;"></div>
                    <span>100% 이상</span>
                </div>
                <div class="original-legend-item">
                    <div class="original-legend-color" style="background: #ff9800;"></div>
                    <span>80% 이상</span>
                </div>
                <div class="original-legend-item">
                    <div class="original-legend-color" style="background: #f44336;"></div>
                    <span>30% 미만</span>
                </div>
            `;
            container.appendChild(legend);

            // 개인정보
            const info = document.createElement('div');
            info.className = 'original-info';
            info.innerHTML = `
                <span>생년월일 ${currentData.personal.birthDate}</span>
                <span>/ 상령일 ${currentData.personal.ageDate}</span>
                <span>/ 손해보험 ${currentData.personal.damageInsurance}건</span>
                <span>/ 생명보험 ${currentData.personal.lifeInsurance}건</span>
                <span>/ 월납보험료 합계 ${currentData.personal.monthlyPremium.toLocaleString()}원</span>
            `;
            container.appendChild(info);

            // 메인 섹션들
            const main = document.createElement('div');
            main.className = 'original-main';

            // 4개 주요 섹션 생성
            const sections = [
                { key: 'family', title: '가족보장' },
                { key: 'disease', title: '큰병보장' },
                { key: 'medical', title: '의료보장' },
                { key: 'care', title: '간병보장' }
            ];

            sections.forEach(sectionInfo => {
                const section = document.createElement('div');
                section.className = 'original-section';

                const sectionData = currentData.sections[sectionInfo.key];
                
                // 헤더
                const header = document.createElement('div');
                header.className = 'original-section-header';
                
                const sectionTitle = document.createElement('div');
                sectionTitle.className = 'original-section-title';
                sectionTitle.textContent = sectionInfo.title;
                
                const score = document.createElement('div');
                score.className = 'original-score';
                score.textContent = `${sectionData.score}점`;
                
                // 점수에 따른 배경색
                let bgColor = '#f44336'; // 30% 미만
                if (sectionData.score >= 100) bgColor = '#4caf50'; // 100% 이상
                else if (sectionData.score >= 80) bgColor = '#ff9800'; // 80% 이상
                score.style.background = bgColor;
                
                header.appendChild(sectionTitle);
                header.appendChild(score);
                section.appendChild(header);

                // 아이템들
                const items = document.createElement('div');
                items.className = 'original-items';
                
                sectionData.items.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'original-item';
                    
                    const shortage = Math.max(0, item.target - item.current);
                    const percentage = Math.min(100, (item.current / item.target) * 100);
                    
                    let barColor = '#f44336';
                    if (percentage >= 100) barColor = '#4caf50';
                    else if (percentage >= 80) barColor = '#ff9800';
                    
                    const unit = sectionInfo.key === 'medical' && item.name.includes('(1일)') ? '만원' : '만원';
                    
                    itemDiv.innerHTML = `
                        <div class="original-item-name">${item.name}</div>
                        <div class="original-item-amount">
                            ${item.current.toLocaleString()}${unit} / ${item.target.toLocaleString()}${unit}
                            ${shortage > 0 ? `<span class="original-shortage">(${shortage.toLocaleString()}${unit} 부족)</span>` : ''}
                        </div>
                        <div class="original-bar">
                            <div class="original-bar-fill" style="width: ${Math.min(100, percentage)}%; background: ${barColor};"></div>
                        </div>
                    `;
                    
                    items.appendChild(itemDiv);
                });
                
                section.appendChild(items);
                main.appendChild(section);
            });

            // 생활보장 섹션
            const lifestyleSection = document.createElement('div');
            lifestyleSection.className = 'original-section original-lifestyle';
            
            const lifestyleHeader = document.createElement('div');
            lifestyleHeader.className = 'original-section-header';
            lifestyleHeader.innerHTML = `
                <div class="original-section-title">생활보장</div>
                <div style="font-size: 10px; color: #666;">
                    <span style="color: #4caf50;">●</span> 적정
                    <span style="color: #ff9800; margin-left: 8px;">▲</span> 부족
                    <span style="color: #f44336; margin-left: 8px;">✕</span> 미보장
                </div>
            `;
            lifestyleSection.appendChild(lifestyleHeader);

            const lifestyleItems = document.createElement('div');
            lifestyleItems.className = 'original-lifestyle-items';
            
            currentData.lifestyle.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'original-lifestyle-item';
                
                const status = document.createElement('div');
                status.className = 'original-status';
                
                if (item.status === 'O') {
                    status.style.background = '#4caf50';
                    status.textContent = '●';
                } else if (item.status === '△') {
                    status.style.background = '#ff9800';
                    status.textContent = '▲';
                } else {
                    status.style.background = '#f44336';
                    status.textContent = '✕';
                }
                
                itemDiv.innerHTML = `
                    <div style="flex: 1; font-weight: bold; margin-bottom: 3px;">${item.name}</div>
                    <div style="font-size: 8px; color: #666; margin-bottom: 3px;">${item.amount.toLocaleString()}만원</div>
                `;
                itemDiv.appendChild(status);
                
                lifestyleItems.appendChild(itemDiv);
            });
            
            lifestyleSection.appendChild(lifestyleItems);
            main.appendChild(lifestyleSection);
            
            container.appendChild(main);

            // 화면에 잠시 표시
            container.style.position = 'fixed';
            container.style.top = '50%';
            container.style.left = '50%';
            container.style.transform = 'translate(-50%, -50%)';
            container.style.zIndex = '1000';
            container.style.boxShadow = '0 10px 30px rgba(0,0,0,0.3)';
            container.style.border = '1px solid #ddd';

            // 3초 후 숨기기
            setTimeout(() => {
                container.style.position = 'absolute';
                container.style.left = '-9999px';
                container.style.top = '-9999px';
                container.style.transform = 'none';
                container.style.zIndex = 'auto';
            }, 3000);
        }

        // 이미지로 다운로드
        function downloadAsImage() {
            const element = document.getElementById('original-layout');
            
            // 원본 레이아웃이 없으면 먼저 생성
            if (!element.innerHTML.trim()) {
                generateOriginalLayout();
                // 생성 후 잠시 기다린 다음 다운로드
                setTimeout(() => {
                    captureAndDownload();
                }, 100);
            } else {
                captureAndDownload();
            }
        }

        function captureAndDownload() {
            // html2canvas 라이브러리를 동적으로 로드
            if (!window.html2canvas) {
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
                script.onload = () => {
                    performCapture();
                };
                document.head.appendChild(script);
            } else {
                performCapture();
            }
        }

        function performCapture() {
            const element = document.getElementById('original-layout');
            
            // 임시로 화면에 표시
            element.style.position = 'fixed';
            element.style.left = '0';
            element.style.top = '0';
            element.style.zIndex = '-1';
            
            html2canvas(element, {
                width: 1200,
                height: 800,
                scale: 2,
                backgroundColor: '#ffffff',
                useCORS: true,
                allowTaint: true
            }).then(canvas => {
                // 다시 숨기기
                element.style.position = 'absolute';
                element.style.left = '-9999px';
                element.style.top = '-9999px';
                element.style.zIndex = 'auto';
                
                // 다운로드
                const link = document.createElement('a');
                link.download = `${currentData.personal.name}_보장분석지_${new Date().toISOString().slice(0,10)}.png`;
                link.href = canvas.toDataURL();
                link.click();
            }).catch(error => {
                console.error('이미지 생성 실패:', error);
                alert('이미지 생성에 실패했습니다. 다시 시도해주세요.');
                
                // 에러 시에도 요소 숨기기
                element.style.position = 'absolute';
                element.style.left = '-9999px';
                element.style.top = '-9999px';
                element.style.zIndex = 'auto';
            });
        }
    </script>
</body>
</html>
